<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MACP æ§åˆ¶å°</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e17; --bg2: #111827; --bg3: #1a2234; --card: #151d2e;
      --border: #2a3548; --text: #f1f5f9; --text2: #94a3b8; --muted: #64748b;
      --accent: #3b82f6; --accent2: #2563eb; --success: #10b981; --warning: #f59e0b; --error: #ef4444;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
    
    .layout { display: flex; min-height: 100vh; }
    
    .sidebar { width: 240px; background: var(--bg2); border-right: 1px solid var(--border); padding: 20px; position: fixed; height: 100vh; }
    .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; }
    .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent), #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; }
    .logo-text { font-size: 18px; font-weight: 600; }
    
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 8px; color: var(--text2); cursor: pointer; margin-bottom: 4px; transition: 0.2s; }
    .nav-item:hover { background: var(--bg3); color: var(--text); }
    .nav-item.active { background: rgba(59,130,246,0.15); color: var(--accent); }
    
    .main { flex: 1; margin-left: 240px; }
    .header { background: var(--bg2); border-bottom: 1px solid var(--border); padding: 16px 30px; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 20px; }
    .btn { padding: 10px 18px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 8px; }
    .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; }
    .btn-secondary { background: var(--bg3); color: var(--text); border: 1px solid var(--border); }
    
    .content { padding: 24px 30px; }
    
    .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .stat { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; }
    .stat::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent), #8b5cf6); }
    .stat:nth-child(2)::before { background: linear-gradient(90deg, var(--success), #06b6d4); }
    .stat:nth-child(3)::before { background: linear-gradient(90deg, var(--warning), var(--error)); }
    .stat:nth-child(4)::before { background: linear-gradient(90deg, #8b5cf6, var(--accent)); }
    .stat-label { font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    .stat-value { font-size: 28px; font-weight: 700; }
    
    .section { margin-bottom: 28px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .section-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    
    .agents { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
    .agent { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: 0.3s; }
    .agent:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
    .agent-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
    .agent-avatar { width: 42px; height: 42px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .agent-avatar.idle { background: rgba(16,185,129,0.15); color: var(--success); }
    .agent-avatar.busy { background: rgba(245,158,11,0.15); color: var(--warning); }
    .agent-avatar.error { background: rgba(239,68,68,0.15); color: var(--error); }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500; }
    .status-badge.idle { background: rgba(16,185,129,0.15); color: var(--success); }
    .status-badge.busy { background: rgba(245,158,11,0.15); color: var(--warning); }
    .agent-name { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .agent-domain { font-size: 12px; color: var(--muted); margin-bottom: 10px; }
    .agent-desc { font-size: 13px; color: var(--text2); line-height: 1.5; margin-bottom: 12px; }
    .caps { display: flex; flex-wrap: wrap; gap: 6px; }
    .cap { background: var(--bg3); padding: 4px 10px; border-radius: 6px; font-size: 11px; color: var(--text2); border: 1px solid var(--border); }
    
    .tasks { background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .task { display: flex; align-items: center; padding: 14px 18px; border-bottom: 1px solid var(--border); }
    .task:last-child { border-bottom: none; }
    .task:hover { background: var(--bg3); }
    .task-info { flex: 1; }
    .task-name { font-size: 14px; font-weight: 500; margin-bottom: 3px; }
    .task-meta { font-size: 12px; color: var(--muted); }
    .task-status { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 500; }
    .task-status.pending { background: var(--bg3); color: var(--text2); }
    .task-status.running { background: rgba(245,158,11,0.15); color: var(--warning); }
    .task-status.completed { background: rgba(16,185,129,0.15); color: var(--success); }
    .task-status.failed { background: rgba(239,68,68,0.15); color: var(--error); }
    
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; z-index: 1000; }
    .modal.show { display: flex; }
    .modal-content { background: var(--bg2); border: 1px solid var(--border); border-radius: 16px; width: 100%; max-width: 500px; }
    .modal-header { padding: 18px 22px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 22px; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: var(--text2); }
    .form-input, .form-select { width: 100%; padding: 12px 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 14px; }
    .form-input:focus, .form-select:focus { outline: none; border-color: var(--accent); }
    .modal-footer { padding: 14px 22px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }
    
    .empty { text-align: center; padding: 50px; color: var(--muted); }
    
    @media (max-width: 1200px) { .stats { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">M</div>
        <span class="logo-text">MACP</span>
      </div>
      <div class="nav">
        <div class="nav-item active" id="nav-dashboard" onclick="showTab('dashboard')">ğŸ“Š æ§åˆ¶å°</div>
        <div class="nav-item" id="nav-agents" onclick="showTab('agents')">ğŸ¤– æ™ºèƒ½ä½“</div>
        <div class="nav-item" id="nav-tasks" onclick="showTab('tasks')">ğŸ“‹ ä»»åŠ¡</div>
        <div class="nav-item" id="nav-profit" onclick="showTab('profit')">ğŸ’° ç›ˆåˆ©</div>
        <div class="nav-item" id="nav-logs" onclick="showTab('logs')">ğŸ“ æ—¥å¿—</div>
        <div class="nav-item" onclick="window.open('http://localhost:18789','_blank')">âœ¨ OpenClaw</div>
      </div>
    </aside>
    
    <main class="main">
      <header class="header">
        <h1 id="pageTitle">æ§åˆ¶å°</h1>
        <button class="btn btn-primary" onclick="openModal()">+ æ–°å»ºä»»åŠ¡</button>
      </header>
      
      <div class="content" id="content"></div>
    </main>
  </div>
  
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>åˆ›å»ºä»»åŠ¡</h3>
        <button class="btn btn-secondary" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ä»»åŠ¡åç§°</label>
          <input type="text" class="form-input" id="taskName" placeholder="è¾“å…¥ä»»åŠ¡åç§°">
        </div>
        <div class="form-group">
          <label class="form-label">èƒ½åŠ›</label>
          <select class="form-select" id="taskCap">
            <option value="">é€‰æ‹©èƒ½åŠ›</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">æ“ä½œç±»å‹</label>
          <select class="form-select" id="taskAction" onchange="togglePrompt()">
            <option value="chat">AI å¯¹è¯</option>
            <option value="list_sessions">åˆ—å‡ºä¼šè¯</option>
          </select>
        </div>
        <div class="form-group" id="promptGroup">
          <label class="form-label">å¯¹è¯å†…å®¹</label>
          <input type="text" class="form-input" id="taskPrompt" placeholder="è¾“å…¥ä½ æƒ³é—®çš„å†…å®¹...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="submitTask()">åˆ›å»º</button>
      </div>
    </div>
  </div>

  <script>
    const API = 'http://localhost:3000/api';
    let agents = [], tasks = [], logs = [];
    let currentTab = 'dashboard';
    let profitData = {daily: {revenue: 0, costs: 0, profit: 0}, total: 0, breakdown: {}};
    
    async function fetchData() {
      try {
        const [a, t, l, p] = await Promise.all([
          fetch(API + '/agents').then(r => r.json()).catch(() => []),
          fetch(API + '/tasks').then(r => r.json()).catch(() => []),
          fetch(API + '/logs').then(r => r.json()).catch(() => []),
          fetch(API + '/profit').then(r => r.json()).catch(() => ({daily: {revenue: 0, costs: 0, profit: 0}, total: 0, breakdown: {}}))
        ]);
        agents = a || [];
        tasks = t || [];
        logs = Array.isArray(l) ? l.slice(-30) : [];
        profitData = p || {daily: {revenue: 0, costs: 0, profit: 0}, total: 0, breakdown: {}};
        render();
      } catch(e) { 
        console.error('Fetch error:', e); 
        document.getElementById('content').innerHTML = '<div class="empty">æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿ MACP æœåŠ¡æ­£åœ¨è¿è¡Œ</div>';
      }
    }
    
    function render() {
      const c = document.getElementById('content');
      const caps = [...new Set(agents.flatMap(a => a.capabilities ? a.capabilities.map(c => c.name || c) : []))];
      const capNames = {chat: 'AIå¯¹è¯', invoke_tool: 'è°ƒç”¨å·¥å…·', list_sessions: 'åˆ—å‡ºä¼šè¯', session_management: 'ä¼šè¯ç®¡ç†', code_generation: 'ä»£ç ç”Ÿæˆ', code_review: 'ä»£ç å®¡æŸ¥'};
      document.getElementById('taskCap').innerHTML = '<option value="">é€‰æ‹©èƒ½åŠ›</option>' + caps.map(x => '<option value="' + x + '">' + (capNames[x] || x) + '</option>').join('');
      
      if (currentTab === 'dashboard') {
        const running = agents.filter(a => a.status === 'busy').length;
        const completed = tasks.filter(t => t.status === 'completed').length;
        const successRate = tasks.length ? Math.round(completed / tasks.length * 100) : 0;
        c.innerHTML = 
          '<div class="stats">' +
            '<div class="stat"><div class="stat-label">æ™ºèƒ½ä½“æ€»æ•°</div><div class="stat-value">' + agents.length + '</div></div>' +
            '<div class="stat"><div class="stat-label">è¿è¡Œä¸­</div><div class="stat-value">' + running + '</div></div>' +
            '<div class="stat"><div class="stat-label">ä»»åŠ¡æ€»æ•°</div><div class="stat-value">' + tasks.length + '</div></div>' +
            '<div class="stat"><div class="stat-label">æˆåŠŸç‡</div><div class="stat-value">' + successRate + '%</div></div>' +
          '</div>' +
          '<div class="section">' +
            '<div class="section-header"><h2 class="section-title">ğŸ“‹ æœ€è¿‘ä»»åŠ¡</h2></div>' +
            '<div class="tasks">' + 
              (tasks.slice(-8).reverse().map(t => 
                '<div class="task"><div class="task-info"><div class="task-name">' + t.name + '</div><div class="task-meta">' + new Date(t.createdAt).toLocaleString('zh-CN') + '</div></div><span class="task-status ' + t.status + '">' + 
                  (t.status === 'pending' ? 'ç­‰å¾…' : t.status === 'running' ? 'è¿è¡Œä¸­' : t.status === 'completed' ? 'å®Œæˆ' : 'å¤±è´¥') + 
                '</span></div>'
              ).join('') || '<div class="empty">æš‚æ— ä»»åŠ¡</div>') +
            '</div></div>';
      } else if (currentTab === 'agents') {
        c.innerHTML = '<div class="section"><div class="section-header"><h2 class="section-title">ğŸ¤– æ™ºèƒ½ä½“åˆ—è¡¨</h2></div>' +
          '<div class="agents">' + 
            (agents.map(a => 
              '<div class="agent">' +
                '<div class="agent-header"><div class="agent-avatar ' + a.status + '">ğŸ¤–</div><span class="status-badge ' + a.status + '">' + 
                  (a.status === 'idle' ? 'ç©ºé—²' : a.status === 'busy' ? 'å¿™ç¢Œ' : 'é”™è¯¯') + 
                '</span></div>' +
                '<div class="agent-name">' + a.name + '</div>' +
                '<div class="agent-domain">' + (a.domain || '') + '</div>' +
                '<div class="agent-desc">' + (a.description || '') + '</div>' +
                '<div class="caps">' + 
                  (a.capabilities ? a.capabilities.map(c => {
                    const name = c.name || c;
                    const cn = {chat: 'AIå¯¹è¯', invoke_tool: 'è°ƒç”¨å·¥å…·', list_sessions: 'åˆ—å‡ºä¼šè¯', session_management: 'ä¼šè¯ç®¡ç†', code_generation: 'ä»£ç ç”Ÿæˆ', code_review: 'ä»£ç å®¡æŸ¥'}[name] || name;
                    return '<span class="cap">' + cn + '</span>';
                  }).join('') : '') + 
                '</div></div>'
            ).join('') || '<div class="empty">æš‚æ— æ™ºèƒ½ä½“</div>') +
          '</div></div>';
      } else if (currentTab === 'tasks') {
        c.innerHTML = '<div class="section"><div class="section-header"><h2 class="section-title">ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h2><button class="btn btn-primary" onclick="openModal()">+ æ–°å»º</button></div>' +
          '<div class="tasks">' + 
              (tasks.slice(-20).reverse().map(t => 
              '<div class="task"><div class="task-info"><div class="task-name">' + t.name + '</div><div class="task-meta">' + 
                (t.input ? ((t.input.action === 'chat' ? 'AIå¯¹è¯' : t.input.action === 'list_sessions' ? 'åˆ—å‡ºä¼šè¯' : t.input.prompt || t.input.action || 'æ— ')) : 'æ— ') +
                (t.output && t.output.response ? ' â€¢ ' + t.output.response.substring(0, 40) + '...' : '') + 
              '</div></div><span class="task-status ' + t.status + '">' + 
                (t.status === 'pending' ? 'ç­‰å¾…' : t.status === 'running' ? 'è¿è¡Œä¸­' : t.status === 'completed' ? 'å®Œæˆ' : 'å¤±è´¥') + 
              '</span></div>'
            ).join('') || '<div class="empty">æš‚æ— ä»»åŠ¡</div>') +
          '</div></div>';
      } else if (currentTab === 'logs') {
        c.innerHTML = '<div class="section"><div class="section-header"><h2 class="section-title">ğŸ“ ç³»ç»Ÿæ—¥å¿—</h2></div>' +
          '<div class="tasks">' + 
              (logs.map(l => 
              '<div class="task"><div class="task-info"><div class="task-name"><span style="color:' + 
                (l.level === 'error' ? '#ef4444' : l.level === 'warn' ? '#f59e0b' : '#3b82f6') + '">' + 
                (l.level === 'error' ? 'é”™è¯¯' : l.level === 'warn' ? 'è­¦å‘Š' : l.level === 'info' ? 'ä¿¡æ¯' : (l.level || 'info').toUpperCase()) + 
              '</span></div><div class="task-meta">' +
                (l.timestamp ? new Date(l.timestamp).toLocaleString('zh-CN') : '') + ' â€¢ ' + (l.message || '') + 
              '</div></div></div>'
            ).join('') || '<div class="empty">æš‚æ— æ—¥å¿—</div>') +
          '</div></div>';
      } else if (currentTab === 'profit') {
        const profit = profitData || {daily: {revenue: 0, costs: 0, profit: 0}, total: 0, breakdown: {}};
        c.innerHTML = 
          '<div class="stats">' +
            '<div class="stat"><div class="stat-label">ä»Šæ—¥æ”¶å…¥</div><div class="stat-value" style="color:var(--success)">$' + profit.daily.revenue.toFixed(2) + '</div></div>' +
            '<div class="stat"><div class="stat-label">ä»Šæ—¥æˆæœ¬</div><div class="stat-value" style="color:var(--error)">$' + profit.daily.costs.toFixed(2) + '</div></div>' +
            '<div class="stat"><div class="stat-label">ä»Šæ—¥åˆ©æ¶¦</div><div class="stat-value" style="color:' + (profit.daily.profit >= 0 ? 'var(--success)' : 'var(--error)') + '">$' + profit.daily.profit.toFixed(2) + '</div></div>' +
            '<div class="stat"><div class="stat-label">æ€»æ”¶å…¥</div><div class="stat-value">$' + profit.total.toFixed(2) + '</div></div>' +
          '</div>' +
          '<div class="section">' +
            '<div class="section-header"><h2 class="section-title">ğŸ’° ç›ˆåˆ©æ¨¡å¼</h2></div>' +
            '<div class="agents">' + 
              '<div class="agent"><div class="agent-header"><div class="agent-avatar idle">ğŸ“</div><span class="status-badge idle">è¿è¡Œä¸­</span></div><div class="agent-name">å†…å®¹åˆ›ä½œ + å¹¿å‘Š</div><div class="agent-domain">è‡ªåŠ¨ç”Ÿæˆå†…å®¹ï¼Œé€šè¿‡å¹¿å‘Šè”ç›Ÿç›ˆåˆ©</div><div class="agent-desc">è‡ªåŠ¨è¿½è¸ªçƒ­ç‚¹ã€ç”Ÿæˆæ–‡ç« ã€å‘å¸ƒåˆ°å¹³å°ã€åµŒå…¥å¹¿å‘Š</div><div class="caps"><span class="cap">æ–‡ç« ç”Ÿæˆ</span><span class="cap">SEOä¼˜åŒ–</span><span class="cap">å¹¿å‘ŠæŠ•æ”¾</span></div></div>' +
              '<div class="agent"><div class="agent-header"><div class="agent-avatar idle">ğŸ›’</div><span class="status-badge idle">è¿è¡Œä¸­</span></div><div class="agent-name">ç”µå•†ä»£è¿è¥</div><div class="agent-domain">è‡ªåŠ¨åˆ†æå•†å“ã€ä¸Šæ¶ã€å®¢æœ</div><div class="agent-desc">å•†å“è°ƒç ”ã€æ–‡æ¡ˆç”Ÿæˆã€æ™ºèƒ½å®¢æœã€è¯„ä»·ç®¡ç†</div><div class="caps"><span class="cap">é€‰å“åˆ†æ</span><span class="cap">è‡ªåŠ¨ä¸Šæ¶</span><span class="cap">æ™ºèƒ½å®¢æœ</span></div></div>' +
              '<div class="agent"><div class="agent-header"><div class="agent-avatar ' + (profit.daily.profit >= 0 ? 'idle' : 'busy') + '">ğŸ“ˆ</div><span class="status-badge ' + (profit.daily.profit >= 0 ? 'idle' : 'busy') + '">' + (profit.daily.profit >= 0 ? 'ç›ˆåˆ©ä¸­' : 'äºæŸä¸­') + '</span></div><div class="agent-name">AI é‡åŒ–äº¤æ˜“</div><div class="agent-domain">è‡ªåŠ¨åˆ†æå¸‚åœºã€æ‰§è¡Œäº¤æ˜“</div><div class="agent-desc">å¸‚åœºæ•°æ®é‡‡é›†ã€æŠ€æœ¯åˆ†æã€ä¿¡å·ç”Ÿæˆã€è‡ªåŠ¨äº¤æ˜“</div><div class="caps"><span class="cap">æŠ€æœ¯åˆ†æ</span><span class="cap">ä¿¡å·ç”Ÿæˆ</span><span class="cap">è‡ªåŠ¨äº¤æ˜“</span></div></div>' +
              '<div class="agent"><div class="agent-header"><div class="agent-avatar idle">â˜ï¸</div><span class="status-badge idle">è¿è¡Œä¸­</span></div><div class="agent-name">SaaS API æœåŠ¡</div><div class="agent-domain">æä¾› AI API æœåŠ¡ï¼ŒæŒ‰è°ƒç”¨æ”¶è´¹</div><div class="agent-desc">API å¯†é’¥ç®¡ç†ã€ç”¨é‡ç»Ÿè®¡ã€è®¢é˜…è®¡è´¹</div><div class="caps"><span class="cap">APIè°ƒç”¨</span><span class="cap">ç”¨é‡è®¡è´¹</span><span class="cap">è®¢é˜…ç®¡ç†</span></div></div>' +
            '</div></div>' +
          '<div class="section">' +
            '<div class="section-header"><h2 class="section-title">ğŸ“Š æ”¶å…¥åˆ†å¸ƒ</h2></div>' +
            '<div class="tasks">' + 
              (Object.entries(profit.breakdown).map(([source, amount]) => 
                '<div class="task"><div class="task-info"><div class="task-name">' + source + '</div><div class="task-meta">' + (source === 'ads' ? 'å¹¿å‘Šåˆ†æˆ' : source === 'sales' ? 'é”€å”®åˆ†æˆ' : source === 'trading' ? 'äº¤æ˜“ç›ˆåˆ©' : source === 'subscription' ? 'è®¢é˜…æ”¶å…¥' : source === 'api_call' ? 'APIè°ƒç”¨' : source) + '</div></div><span class="task-status completed">$' + (amount || 0).toFixed(2) + '</span></div>'
              ).join('') || '<div class="empty">æš‚æ— æ”¶å…¥æ•°æ®</div>') +
            '</div></div>';
      }
    }
    
    function showTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      const nav = document.getElementById('nav-' + tab);
      if (nav) nav.classList.add('active');
      const titles = {dashboard: 'æ§åˆ¶å°', agents: 'æ™ºèƒ½ä½“', tasks: 'ä»»åŠ¡', profit: 'ç›ˆåˆ©', logs: 'æ—¥å¿—'};
      document.getElementById('pageTitle').innerText = titles[tab];
      render();
    }
    
    function openModal() { document.getElementById('modal').classList.add('show'); }
    function closeModal() { document.getElementById('modal').classList.remove('show'); }
    function togglePrompt() {
      const action = document.getElementById('taskAction').value;
      document.getElementById('promptGroup').style.display = action === 'list_sessions' ? 'none' : 'block';
    }
    
    async function submitTask() {
      const name = document.getElementById('taskName').value;
      const cap = document.getElementById('taskCap').value;
      const action = document.getElementById('taskAction').value;
      const prompt = document.getElementById('taskPrompt').value;
      if (!name || !cap) return alert('è¯·å¡«å†™å®Œæ•´');
      
      const input = action === 'list_sessions' ? {action: 'list_sessions'} : {action: 'chat', prompt: prompt};
      await fetch(API + '/tasks', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name: name, requiredCapabilities: [cap], input: input})
      });
      closeModal();
      fetchData();
    }
    
    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
